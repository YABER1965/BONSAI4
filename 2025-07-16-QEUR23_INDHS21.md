---
title: QEUR23_INDHS21 - 参議院選挙記念-閑話休題～インド占星術でカルマを占う
date: 2025-07-16
tags: ["QEUシステム", "メトリックス", "Python言語", "Unsloth", "LLM", "データセット", "BONSAI", "LangGraph"]
excerpt: あたらしいLLMの学習体系を確立する
---

## QEUR23_INDHS21 - 参議院選挙記念-閑話休題～インド占星術でカルマを占う

## ～ これは、あくまで遊びです！！ ～

### ・・・ 前回のつづきです ・・・

D先生： “今回も、前回の占星術のつづきですか？”

QEU:FOUNDER ： “すごく特殊なことをやってみます。ここではD60分割図を使ってみましょう。念を押しますが、D60分割図は普通の人には使えません。1つの星座を60分割もするので、10分単位で正確な時間が必要です。ただし、D60は分割図の王様であり、**前世の徳とカルマ（業）をみることができる**そうです。また、この図には神が住んでおり、その解釈がとても難しいという・・・。”

![imageINDS1-12-1](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-1.jpg) 

D先生：“・・・わあ・・・。まあ、こんなに正確な時間が必要だというと、公共放送ぐらいしかなくなりますね。例えば・・・。”

![imageINDS1-12-2](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-2.jpg) 


**（大事な放送の内容）**

朕（ちん）深ク世界ノ大勢ト帝国ノ現状トニ鑑ミ非常ノ措置ヲ以（もっ）テ時局ヲ収拾セムト欲シ茲（ここ）ニ忠良ナル爾（なんじ）臣民ニ告ク
朕ハ帝国政府ヲシテ米英支蘇四国ニ対シ其（そ）ノ共同宣言ヲ受諾スル旨通告セシメタリ
抑々（そもそも）帝国臣民ノ康寧（こうねい）ヲ図リ万邦共栄ノ楽ヲ偕（とも）ニスルハ皇祖皇宗ノ遺範ニシテ朕ノ拳々（けんけん）措（お）カサル所曩（さき）ニ米英二国ニ宣戦セル所以（ゆえん）モ亦（また）実ニ帝国ノ自存ト東亜ノ安定トヲ庶幾スルニ出テ他国ノ主権ヲ排シ領土ヲ侵スカ如（ごと）キハ固（もと）ヨリ朕カ志ニアラス然（しか）ルニ交戦已（すで）ニ四歳（しさい）ヲ閲（けみ）シ朕カ陸海将兵ノ勇戦朕カ百僚有司ノ励精朕カ一億衆庶ノ奉公各々最善ヲ尽セルニ拘（かかわ）ラス戦局必スシモ好転セス世界ノ大勢亦我ニ利アラス加之（これにくわうるに）敵ハ新ニ残虐ナル爆弾ヲ使用シテ頻（しきり）ニ無辜ヲ殺傷シ惨害ノ及フ所真ニ測ルヘカラサルニ至ル而（しか）モ尚交戦ヲ継続セムカ終ニ我カ民族ノ滅亡ヲ招来スルノミナラス延（ひい）テ人類ノ文明ヲモ破却スヘシ斯（かく）ノ如クムハ朕何ヲ以テカ億兆ノ赤子（せきし）ヲ保（ほ）シ皇祖皇宗ノ神霊ニ謝セムヤ是（こ）レ朕カ帝国政府ヲシテ共同宣言ニ応セシムルニ至レル所以ナリ
朕ハ帝国ト共ニ終始東亜ノ解放ニ協力セル諸盟邦ニ対シ遺憾ノ意ヲ表セサルヲ得ス帝国臣民ニシテ戦陣ニ死シ職域ニ殉シ非命ニ斃（たお）レタル者及其ノ遺族ニ想（おもい）ヲ致セハ五内（ごだい）為ニ裂ク且（かつ）戦傷ヲ負ヒ災禍ヲ蒙（こうむ）リ家業ヲ失ヒタル者ノ厚生ニ至リテハ朕ノ深ク軫念（しんねん）スル所ナリ惟（おも）フニ今後帝国ノ受クヘキ苦難ハ固ヨリ尋常ニアラス爾臣民ノ衷情モ朕善ク之ヲ知ル然レトモ朕ハ時運ノ趨（おもむ）ク所堪へ難キヲ堪へ忍ヒ難キヲ忍ヒ以テ万世ノ為ニ太平ヲ開カムト欲ス
朕ハ茲ニ国体ヲ護持シ得テ忠良ナル爾臣民ノ赤誠ニ信倚（しんい）シ常ニ爾臣民ト共ニ在リ若シ夫（そ）レ情ノ激スル所濫（みだり）ニ事端（じたん）ヲ滋（しげ）クシ或ハ同胞排擠（はいせい）互ニ時局ヲ乱リ為ニ大道ヲ誤リ信義ヲ世界ニ失フカ如キハ朕最モ之ヲ戒ム宜（よろ）シク挙国一家子孫相伝ヘ確（かた）ク神州ノ不滅ヲ信シ任重クシテ道遠キヲ念（おも）ヒ総力ヲ将来ノ建設ニ傾ケ道義ヲ篤クシ志操ヲ鞏（かた）クシ誓テ国体ノ精華ヲ発揚シ世界ノ進運ニ後レサラムコトヲ期スヘシ爾臣民其レ克（よ）ク朕カ意ヲ体セヨ

QEU:FOUNDER ： “それでは、前回のプログラムの追加分を見てみましょう。プログラムをドン”

```python
# ---
# -*- coding: utf-8 -*-
import swisseph as swe
import pytz
from datetime import datetime, timedelta
import math
import json
import os
import re
from langchain_openai import ChatOpenAI
from langchain.prompts import (
    PromptTemplate,
    ChatPromptTemplate,
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate
)
from langchain.chains import LLMChain
from langgraph.graph import END, StateGraph
from pydantic import BaseModel

# ---
# このプログラムでは、ラヒリ（Lahiri）・アヤナムシャ（サイデリアル）を標準で使用します。
swe.set_ephe_path(None)  # Ephemerisファイルのパス設定
swe.set_sid_mode(swe.SIDM_LAHIRI)

# --- 都市のタイムゾーンと座標 ---
CITY_DATA = {
    '東京': {'tz': 'Asia/Tokyo', 'lat': 35.6895, 'lon': 139.6917},
    '大阪': {'tz': 'Asia/Tokyo', 'lat': 34.6937, 'lon': 135.5023},
    '福岡': {'tz': 'Asia/Tokyo', 'lat': 33.5904, 'lon': 130.4017},
    '北京': {'tz': 'Asia/Shanghai', 'lat': 39.9042, 'lon': 116.4074},
    '上海': {'tz': 'Asia/Shanghai', 'lat': 31.2304, 'lon': 121.4737},
    '成都': {'tz': 'Asia/Shanghai', 'lat': 30.5728, 'lon': 104.0668},
    '香港': {'tz': 'Asia/Hong_Kong', 'lat': 22.3193, 'lon': 114.1694},
    '台北': {'tz': 'Asia/Taipei', 'lat': 25.0320, 'lon': 121.5654},
    'トロント': {'tz': 'America/Toronto', 'lat': 43.6532, 'lon': -79.3832},
    'ロンドン': {'tz': 'Europe/London', 'lat': 51.5074, 'lon': -0.1278},
    'パリ': {'tz': 'Europe/Paris', 'lat': 48.8566, 'lon': 2.3522},
    'ニューヨーク': {'tz': 'America/New_York', 'lat': 40.7128, 'lon': -74.0060},
    'シカゴ': {'tz': 'America/Chicago', 'lat': 41.8781, 'lon': -87.6298},
    'ロサンゼルス': {'tz': 'America/Los_Angeles', 'lat': 34.0522, 'lon': -118.2437},
    'マドリード': {'tz': 'Europe/Madrid', 'lat': 40.4168, 'lon': -3.7038},
    'ストックホルム': {'tz': 'Europe/Stockholm', 'lat': 59.3293, 'lon': 18.0686}
}

# 惑星記号
PLANET_SYMBOLS = {
    swe.SUN: 'Su', swe.MOON: 'Mo', swe.MERCURY: 'Me', swe.VENUS: 'Ve',
    swe.MARS: 'Ma', swe.JUPITER: 'Ju', swe.SATURN: 'Sa',
    swe.MEAN_NODE: 'Ra', swe.TRUE_NODE: 'Ra',
    -swe.MEAN_NODE: 'Ke', -swe.TRUE_NODE: 'Ke'
}

# 星座名（南インド式順序）
S_INDIAN_ZODIAC_BASE = [
    "うお座", "おひつじ座", "おうし座", "ふたご座",
    "かに座", "しし座", "おとめ座", "てんびん座",
    "さそり座", "いて座", "やぎ座", "みずがめ座"
]

# サイン番号から日本語名へ
SIGN_NAMES = {
    1: "おひつじ座", 2: "おうし座", 3: "ふたご座", 4: "かに座",
    5: "しし座", 6: "おとめ座", 7: "てんびん座", 8: "さそり座",
    9: "いて座", 10: "やぎ座", 11: "みずがめ座", 12: "うお座"
}

# 星座の属性
ZODIAC_ATTRIBUTES = {
    "おひつじ座": {"lord": "火星", "nature": "陽", "quality": "活動", "element": "火"},
    "おうし座": {"lord": "金星", "nature": "陰", "quality": "固定", "element": "土"},
    "ふたご座": {"lord": "水星", "nature": "陽", "quality": "変動", "element": "風"},
    "かに座": {"lord": "月", "nature": "陰", "quality": "活動", "element": "水"},
    "しし座": {"lord": "太陽", "nature": "陽", "quality": "固定", "element": "火"},
    "おとめ座": {"lord": "水星", "nature": "陰", "quality": "変動", "element": "土"},
    "てんびん座": {"lord": "金星", "nature": "陽", "quality": "活動", "element": "風"},
    "さそり座": {"lord": "冥王星", "nature": "陰", "quality": "固定", "element": "水"},
    "いて座": {"lord": "木星", "nature": "陽", "quality": "変動", "element": "火"},
    "やぎ座": {"lord": "土星", "nature": "陰", "quality": "活動", "element": "土"},
    "みずがめ座": {"lord": "天王星", "nature": "陽", "quality": "固定", "element": "風"},
    "うお座": {"lord": "木星", "nature": "陰", "quality": "変動", "element": "水"}
}

# ナクシャトラ名（27星座）
NAKSHATRA_NAMES = [
    "アシュヴィニ", "バラニ", "クリッティカー", "ローヒニー", "ムリガシラー", "アールドラー", "プナルヴァス", "プシャミ", "アーシュレーシャ",
    "マカ", "プールヴァ・パルグニ", "ウッタラ・パルグニ", "ハスタ", "チトラー", "スヴァーティー", "ヴィサーカー", "アヌラーダ", "ジエスタ",
    "ムーラ", "プールヴァ・アーシャダー", "ウッタラ・アーシャダー", "シュラヴァナ", "ダニシュター", "シャタビシャー", "プールヴァ・バードラパダ", "ウッタラ・バードラパダ", "レーヴァティー"
]

# ナクシャトラの支配惑星
NAKSHATRA_LORDS = {
    "アシュヴィニ": "ケートゥ", "バラニ": "金星", "クリッティカー": "太陽", "ローヒニー": "月", "ムリガシラー": "火星",
    "アールドラー": "ラーフ", "プナルヴァス": "木星", "プシャミ": "土星", "アーシュレーシャ": "水星", "マカ": "ケートゥ",
    "プールヴァ・パルグニ": "金星", "ウッタラ・パルグニ": "太陽", "ハスタ": "月", "チトラー": "火星", "スヴァーティー": "ラーフ",
    "ヴィサーカー": "木星", "アヌラーダ": "土星", "ジエスタ": "水星", "ムーラ": "ケートゥ", "プールヴァ・アーシャダー": "金星",
    "ウッタラ・アーシャダー": "太陽", "シュラヴァナ": "月", "ダニシュター": "火星", "シャタビシャー": "ラーフ",
    "プールヴァ・バードラパダ": "木星", "ウッタラ・バードラパダ": "土星", "レーヴァティー": "水星"
}

# 惑星の意味
PLANET_MEANINGS = {
    'Su': '自我、権威、リーダーシップ、活力',
    'Mo': '感情、心、母性、感受性',
    'Me': '知性、コミュニケーション、分析力、学習',
    'Ve': '愛、美、快楽、芸術、調和',
    'Ma': '行動力、勇気、競争、攻撃性',
    'Ju': '成長、幸運、知恵、繁栄、スピリチュアリティ、拡大',
    'Sa': '規律、責任、試練、遅延、制限、忍耐',
    'Ra': '変革、欲望、執着、物質的追求、カルマ的な目標、超越',
    'Ke': 'スピリチュアルな欲望、カルマの解放、スピリチュアル、過去のカルマ'
}

# --- 関数群 ---
def get_nakshatra(jd):
    """月の位置からナクシャトラを取得"""
    moon_pos, _ = swe.calc_ut(jd, swe.MOON)
    nakshatra_index = int(moon_pos[0] / (360/27)) % 27
    name = NAKSHATRA_NAMES[nakshatra_index]
    lord = NAKSHATRA_LORDS[name]
    return {'index': nakshatra_index, 'name': name, 'lord': lord}

def calculate_birth_chart(year, month, day, hour, minute, lat, lon):
    """出生図(D1)を計算"""
    swe.set_ephe_path(None)
    dt = datetime(year, month, day, hour, minute)
    local_tz = pytz.timezone(CITY_DATA['東京']['tz'])
    local_dt = local_tz.localize(dt)
    utc_dt = local_dt.astimezone(pytz.utc)
    jd = swe.julday(utc_dt.year, utc_dt.month, utc_dt.day, utc_dt.hour + utc_dt.minute/60)
    cusps, ascmc = swe.houses(jd, lat, lon, b'P')
    asc_sign = int(ascmc[0] / 30) + 1
    planets = {}
    planet_positions = {}
    for planet in [swe.SUN, swe.MOON, swe.MERCURY, swe.VENUS, swe.MARS,
                   swe.JUPITER, swe.SATURN, swe.TRUE_NODE]:
        pos, _ = swe.calc_ut(jd, planet)
        sign = int(pos[0] / 30) % 12 + 1
        degree = pos[0] % 30
        planets[planet] = sign
        planet_positions[planet] = degree
    # ケートゥはラーフの反対側
    planets[-swe.TRUE_NODE] = (planets[swe.TRUE_NODE] + 6) % 12 or 12
    planet_positions[-swe.TRUE_NODE] = (planet_positions[swe.TRUE_NODE] + 180) % 360 % 30
    planet_positions[swe.ASC] = ascmc[0] % 30
    houses = [int(c/30) % 12 + 1 for c in cusps[:12]]
    return {'ascendant': asc_sign, 'planets': planets, 'planet_positions': planet_positions, 'houses': houses, 'jd': jd}


def calculate_division_chart(year, month, day, hour, minute, lat, lon, division):
    """分割図(D9, D60)を計算"""
    swe.set_ephe_path(None)
    dt = datetime(year, month, day, hour, minute)
    local_tz = pytz.timezone(CITY_DATA['東京']['tz'])
    local_dt = local_tz.localize(dt)
    utc_dt = local_dt.astimezone(pytz.utc)
    jd = swe.julday(utc_dt.year, utc_dt.month, utc_dt.day, utc_dt.hour + utc_dt.minute/60)
    divisor = 9 if division == 'D9' else 60 if division == 'D60' else 12
    cusps, ascmc = swe.houses(jd, lat, lon, b'P')
    asc_pos = ascmc[0]
    d_asc_pos = (asc_pos * divisor) % 360
    d_asc_sign = int(d_asc_pos / 30) + 1
    planets = {}
    planet_positions = {}
    for planet in [swe.SUN, swe.MOON, swe.MERCURY, swe.VENUS, swe.MARS,
                   swe.JUPITER, swe.SATURN, swe.TRUE_NODE]:
        pos, _ = swe.calc_ut(jd, planet)
        d_pos = (pos[0] * divisor) % 360
        d_sign = int(d_pos / 30) + 1
        planets[planet] = d_sign
        planet_positions[planet] = d_pos % 30
    planets[-swe.TRUE_NODE] = (planets[swe.TRUE_NODE] + 6) % 12 or 12
    planet_positions[-swe.TRUE_NODE] = (planet_positions[swe.TRUE_NODE] + 180) % 360 % 30
    planet_positions[swe.ASC] = d_asc_pos % 30
    houses = []
    for i in range(12):
        house_sign = int((d_asc_pos + i * 30) / 30) % 12 + 1
        houses.append(house_sign)
    return {'ascendant': d_asc_sign, 'planets': planets, 'planet_positions': planet_positions, 'houses': houses}

# 南インド式星座リスト (アセンダントがHouse1になるように動的に変更)
def get_rotated_zodiac(asc_sign):
    """アセンダントから回転した南インド式星座リストを返す"""
    base = S_INDIAN_ZODIAC_BASE
    start = (asc_sign - 1) % 12
    return base[start:] + base[:start]

def create_south_indian_chart(asc_sign, planets, planet_positions, user_info):
    """南インド式チャートを作成しMarkdownテーブル形式で返す"""
    rotated_zodiac = get_rotated_zodiac(asc_sign)
    sign_to_house = {rotated_zodiac[i]: i+1 for i in range(12)}
    house_planets = {i: [] for i in range(1, 13)}
    for planet, sign in planets.items():
        sign_name = SIGN_NAMES[sign]
        if sign_name in sign_to_house:
            house = sign_to_house[sign_name]
            symbol = PLANET_SYMBOLS.get(planet, '?')
            degree = round(planet_positions.get(planet, 0), 1)
            house_planets[house].append(f"{symbol}:{degree}")
    # アセンダントをHouse1に追加
    asc_degree = round(planet_positions.get(swe.ASC, 0), 1)
    house_planets[1].append(f"As:{asc_degree}")
    # 4x4グリッド配置
    grid = {}
    grid[(0,0)] = f"{rotated_zodiac[0]}:1{','.join(house_planets[1])}"
    grid[(0,1)] = f"{rotated_zodiac[1]}:2{','.join(house_planets[2])}"
    grid[(0,2)] = f"{rotated_zodiac[2]}:3{','.join(house_planets[3])}"
    grid[(0,3)] = f"{rotated_zodiac[3]}:4{','.join(house_planets[4])}"
    grid[(1,0)] = f"{rotated_zodiac[11]}:12{','.join(house_planets[12])}"
    grid[(1,1)] = user_info['date']
    grid[(1,2)] = user_info['time']
    grid[(1,3)] = f"{rotated_zodiac[4]}:5{','.join(house_planets[5])}"
    grid[(2,0)] = f"{rotated_zodiac[10]}:11{','.join(house_planets[11])}"
    grid[(2,1)] = user_info['place']
    grid[(2,2)] = user_info['user_name']
    grid[(2,3)] = f"{rotated_zodiac[5]}:6{','.join(house_planets[6])}"
    grid[(3,0)] = f"{rotated_zodiac[9]}:10{','.join(house_planets[10])}"
    grid[(3,1)] = f"{rotated_zodiac[8]}:9{','.join(house_planets[9])}"
    grid[(3,2)] = f"{rotated_zodiac[7]}:8{','.join(house_planets[8])}"
    grid[(3,3)] = f"{rotated_zodiac[6]}:7{','.join(house_planets[7])}"
    # Markdownテーブル生成
    markdown = "| " + " | ".join([grid.get((0,i), "") for i in range(4)]) + " |\n"
    markdown += "|:--------------|:-----------|:-------------|:-------------|\n"
    for r in range(1,4):
        row = "| " + " | ".join([grid.get((r,i), "") for i in range(4)]) + " |"
        markdown += row + "\n"
    return markdown, rotated_zodiac, house_planets

def create_summary_table(rotated_zodiac, house_planets):
    """まとめ表をMarkdownで作成"""
    table = "| ハウスNO | ハウスの星座 | ハウスの主管惑星 | 陰陽 | 活動/固定/変動 | 火/土/風/水 | 配置された惑星名と星位 |\n"
    table += "| ------ | ---- | ------ | ---- | -----------| ------| ------|\n"
    for house in range(1, 13):
        sign_name = rotated_zodiac[house-1]
        attr = ZODIAC_ATTRIBUTES.get(sign_name, {})
        planets_str = ",".join(house_planets.get(house, [])) if house_planets.get(house) else ""
        table += f"| {house} | {sign_name} | {attr.get('lord', '')} | {attr.get('nature', '')} | {attr.get('quality', '')} | {attr.get('element', '')} | {planets_str} |\n"
    return table

#def generate_dasha_comment(dasha_lord, nakshatra_info, user_info, antardasha=None):
def generate_dasha_comment(user_info_dasha, dasha_lord, nakshatra_info, user_info, antar-dasha=None):
    """LLMでダシャーまたはアンタルダシャーの運勢コメントを生成"""
    # ...中身は同じ...
    """LLMでダシャーまたはアンタルダシャーの運勢コメントを生成"""
    llm = ChatOpenAI(
        model="deepseek-chat",
        api_key=os.getenv("DEEPSEEK_API_KEY"),
        base_url="https://api.deepseek.com",
        temperature=0.5
    )
    system_template = "あなたは優秀な占い師です。以下の情報に基づいて、ダシャー期間の運勢の特徴を簡潔に説明してください。"
    human_template = """以下のユーザーからの情報にしたがって、インド占星術の占いをしてください。

### ユーザー情報
ユーザー名: {user_name}
生年月日: {birth_date}
出生地: {place}

### ユーザーからの情報:
{user_info_dasha}

以下は、インド占星術から得られた重要な情報群です。

### ナクシャトラ（月宿）
ナクシャトラ名: {nakshatra_name}
支配惑星: {nakshatra_lord}

### ダシャー情報
大ダシャー惑星: {dasha_lord} ({planet_name})
{antardasha_line}

### 出力形式
運勢の特徴を100文字以内で簡潔に記述してください。
"""
    planet_names = {
        'Su': '太陽', 'Mo': '月', 'Me': '水星', 'Ve': '金星',
        'Ma': '火星', 'Ju': '木星', 'Sa': '土星', 'Ra': 'ラーフ', 'Ke': 'ケートゥ'
    }
    antardasha_line = ""
    if antardasha:
        antardasha_line = f"小ダシャー惑星: {antardasha} ({planet_names.get(antardasha, antar-dasha)})"
    system_msg = SystemMessagePromptTemplate.from_template(system_template)
    human_msg = HumanMessagePromptTemplate.from_template(human_template)
    chat_prompt = ChatPromptTemplate.from_messages([system_msg, human_msg])
    response = llm.invoke(chat_prompt.format_messages(
        user_name=user_info['user_name'],
        birth_date=user_info['date'],
        user_info_dasha=user_info_dasha,
        place=user_info['place'],
        nakshatra_name=nakshatra_info['name'],
        nakshatra_lord=nakshatra_info['lord'],
        dasha_lord=dasha_lord,
        planet_name=planet_names.get(dasha_lord, dasha_lord),
        antardasha_line=antardasha_line
    ))
    return response.content.strip()

def create_dasha_schedule(user_info_dasha, birth_jd, nakshatra_info, user_info, end_year=2040):
    """ヴィムショッタリ・ダシャーとアンタルダシャーのスケジュール作成"""
    DASHA_PERIODS = {
        'Ke': 7, 'Ve': 20, 'Su': 6, 'Mo': 10, 'Ma': 7,
        'Ra': 18, 'Ju': 16, 'Sa': 19, 'Me': 17
    }
    dashas = ['Ke', 'Ve', 'Su', 'Mo', 'Ma', 'Ra', 'Ju', 'Sa', 'Me']
    # ナクシャトラ支配惑星を記号化
    lord_jp = nakshatra_info['lord']
    first_char = lord_jp[0]
    jp_to_sym = {'ケ': 'Ke', '金': 'Ve', '太': 'Su', '月': 'Mo', '火': 'Ma', 'ラ': 'Ra', '木': 'Ju', '土': 'Sa', '水': 'Me'}
    lord_symbol = jp_to_sym.get(first_char, 'Ke')
    start_index = dashas.index(lord_symbol)
    birth_date = swe.revjul(birth_jd)
    year, month, day, hour_frac = birth_date
    extra_days = int(hour_frac // 24)
    hour_frac %= 24
    hours = int(hour_frac)
    minutes = int((hour_frac - hours) * 60)
    birth_dt = datetime(year, month, day, hours, minutes) + timedelta(days=extra_days)
    dasha_schedule = []
    current_date = birth_dt
    total_years = 0
    # 初期ダシャー期間調整（ナクシャトラ内の位置により）
    nakshatra_pos = (nakshatra_info['index'] * (360/27))
    # 月の度数を取得し、ナクシャトラ内の度数を計算
    # ここでは簡易的に初期期間を全期間とする（詳細計算は省略）
    initial_period = DASHA_PERIODS[lord_symbol]
    # 大ダシャー期間ループ
    for i in range(len(dashas)):
        dasha_lord = dashas[(start_index + i) % len(dashas)]
        period = DASHA_PERIODS[dasha_lord]
        if total_years + period > (end_year - birth_dt.year):
            period = end_year - birth_dt.year - total_years
        end_date = current_date + timedelta(days=period*365)
        # アンタルダシャー（小ダシャー）を大ダシャー内で順に回す（簡易的に全ての惑星を順に）
        antardashas = dashas  # 同じ順序で
        antardasha_comments = []
        for antardasha in antardashas:
            comment = generate_dasha_comment(user_info_dasha, dasha_lord, nakshatra_info, user_info, antardasha=antardasha)
            antardasha_comments.append(f"{antardasha}: {comment}")
        comment = generate_dasha_comment(user_info_dasha, dasha_lord, nakshatra_info, user_info)
        dasha_schedule.append({
            'dasha': dasha_lord,
            'start': current_date.strftime('%Y-%m-%d'),
            'end': end_date.strftime('%Y-%m-%d'),
            'duration': round(period, 2),
            'comment': comment,
            'antardashas': antardasha_comments
        })
        current_date = end_date
        total_years += period
        if total_years >= (end_year - birth_dt.year):
            break
    return dasha_schedule

# --- メイン実行部分 ---
#def main():
# ユーザー入力（生年月日・出生地・ユーザー名を一回入力に統合）
user_data = {
    'date': '1945年8月15日',
    'time': '12:00',
    'place': '東京',
    'user_name': '某国'
}
dt = datetime.strptime(f"{user_data['date']} {user_data['time']}", "%Y年%m月%d日 %H:%M")
city = CITY_DATA[user_data['place']]

# ---
# D60分割図のまとめ表
d60_summary = create_summary_table(d60_rotated_zodiac, d60_house_planets)
# 結果表示
print("\n## D60（ショダシャムシャ）分割図のまとめ表")
print(d60_summary)

```

QEU:FOUNDER ： “このプログラムでD60分割図を出してみるとこうなりました。一見は、D1（出生）図と同じ、普通のチャートなのですがね。ここには、**「神が住んでいる」**らしいです。”

## D60（ショダシャムシャ）分割図のまとめ表

| ハウスNO | ハウスの星座 | ハウスの主管惑星 | 陰陽 | 活動/固定/変動 | 火/土/風/水 | 配置された惑星名と星位 |
| ------ | ---- | ------ | ---- | -----------| ------| ------|
| 1 | みずがめ座 | 天王星 | 陽 | 固定 | 風 | Ke:11.5,As:4.1 |
| 2 | うお座 | 木星 | 陰 | 変動 | 水 |  |
| 3 | おひつじ座 | 火星 | 陽 | 活動 | 火 | Mo:9.1,Ve:6.1 |
| 4 | おうし座 | 金星 | 陰 | 固定 | 土 |  |
| 5 | ふたご座 | 水星 | 陽 | 変動 | 風 | Sa:18.2 |
| 6 | かに座 | 月 | 陰 | 活動 | 水 | Me:13.6 |
| 7 | しし座 | 太陽 | 陽 | 固定 | 火 | Ra:11.5 |
| 8 | おとめ座 | 水星 | 陰 | 変動 | 土 |  |
| 9 | てんびん座 | 金星 | 陽 | 活動 | 風 | Ma:13.3 |
| 10 | さそり座 | 冥王星 | 陰 | 固定 | 水 | Su:4.1 |
| 11 | いて座 | 木星 | 陽 | 変動 | 火 | Ju:0.0 |
| 12 | やぎ座 | 土星 | 陰 | 活動 | 土 |  |

D先生： “これに神様が住んでいるんですか？ “

QEU:FOUNDER ： “そこらへんの「神様の見つけ方」は、AIで調べても全然わかりません。ひょっとしたら、「本場」で本気で勉強して初めてわかることなのかもね・・・。それでも、LLMはなぜか関連の記事を学習しているのか、それらしいコメントを出してくれます。さてと・・・。これから、ず～っと（コードを）スキップします。最後のアウトプットである、運勢の総評のプログラムを見てみましょう。”

```python
# ---
# ユーザーメッセージ(まとめ用)
user_message = """私は某国です。1945年に第2次世界大戦に負け、私は生まれ変わりました。1960年代に高度成長し、1980年代には先進国に匹敵する豊かな国家と呼ばれました。
しかし、1990年代のバブル崩壊から、21世紀にはいって経済も悪く、政治も停滞しています。国民も勤勉なので、何が悪いためこのような状態になっているのかがわかりません。
21世紀に入ってから、経済、文化、政治的な側面の多くが停滞しており、国民の人心も徐々にすさんで政治の腐敗と排外主義や差別も蔓延しています。
現在は、2025年です。これからに起こること、もし、これから災難があれば、それを避ける方法を提案してください。"""

# ---
# 1ショットプロンプトの例
output_style = """
**[AIアシスタントのメッセージ例]**
{
  "analysis": [
    {
      "house": "1室",
      "sign": "てんびん座",
      "meaning": "自我、外見、人生の始まり",
      "planets": "As:8.7",
      "interpretation": "社交的で調和を重んじる性格。外見に気を遣う傾向あり。"
    },
    ... # 他のハウスの分析
  ],
  "overall": {
    "personality": "バランス感覚に優れ、対人関係を大切にする性格。",
    "abilities": "交渉力と美的センスに優れる。",
    "achievements": "人間関係を活かした分野で成功の可能性大。",
    "fortune_2025_2040": "2025-2032年は成長期、2032年以降は安定期。"
  }
}
"""

# ---
def analyze_with_llm(d1_summary, d9_summary, d60_summary, dasha_schedule_str, us-er_message):
    """LLMで総合分析を実行（D1, D9, D60, ダシャー情報を統合）"""
    llm = ChatOpenAI(
        model="deepseek-reasoner",
        api_key=os.getenv("DEEPSEEK_API_KEY"),
        base_url="https://api.deepseek.com",
        temperature=0.3
    )
    
    # プロンプトテンプレート
    system_template = """あなたは優秀な占い師です。以下の情報を統合して、総合的な分析を行ってください。
    
    出力は、必ずJSON形式であること。また、以下のキーを含むこと:
    - "analysis": 各ハウスの分析（1室から12室まで）
    - "overall": 総合分析（性格、能力、成果予測、運勢）
    
    分析のポイント:
    - 各ハウスの意味と配置された惑星の影響を十分に考慮すること
    - D1、D9、D60チャートの惑星配置と意味を統合的に解釈
    - ヴィムショッタリ・ダシャーのスケジュールを考慮して将来を予測すること
    - 具体的で実用的な解釈を提供すること
    - 専門的でありながら、ユーザーにとって分かりやすい表現を使用すること
    """
    
    human_template = """以下のユーザーの要求にしたがって、占いをしてユーザーにアドバイスをしてください。
    
### ユーザーからのメッセージ:
{user_message}
    
以下は、インド占星術から得られた重要な情報群です。
    
    ### 出生図(D1)のまとめ表:
    {d1_summary}
    
    ### D9（ナヴァムシャ）分割図のまとめ表:
    {d9_summary}
    
### D60分割図まとめ表:
{d60_summary}

### ヴィムショッタリ・ダシャーとアンタルダシャーのスケジュール:
{dasha_schedule}
    
    ### 出力型式:
    {output_style}
    
    上記の情報を統合して分析してください。
    """
    
    # プロンプト作成
    system_message_prompt = SystemMessagePromptTemplate.from_template(system_template)
    human_message_prompt = HumanMessagePromptTemplate.from_template(human_template)
    chat_prompt = ChatPromptTemplate.from_messages([system_message_prompt, hu-man_message_prompt])
    
    # LLMを呼び出し
    response = llm.invoke(chat_prompt.format_messages(
        d1_summary=d1_summary,
        d9_summary=d9_summary,
        d60_summary=d60_summary,
        dasha_schedule=dasha_schedule_str,
        user_message=user_message,
        output_style=output_style
    ))
    
    # JSONデータを抽出
    json_str = re.search(r'\{.*\}', response.content, re.DOTALL).group()
    return json.loads(json_str.strip())

# --- 状態管理とワークフロー ---

class AnalysisState(BaseModel):
    d1_summary: str
    d9_summary: str
    d60_summary: str
    dasha_schedule_str: str
    user_message: str
    full_result: dict = None

def create_analysis_workflow():
    workflow = StateGraph(AnalysisState)
    def run_analysis(state):
        result = analyze_with_llm(
            state.d1_summary,
            state.d9_summary,
            state.d60_summary,
            state.dasha_schedule_str,
            state.user_message
        )
        state.full_result = result
        return state
    workflow.add_node("run_analysis", run_analysis)
    workflow.set_entry_point("run_analysis")
    workflow.add_edge("run_analysis", END)
    return workflow.compile()

# ---
# 総合分析を実行
workflow = create_analysis_workflow()

# ---
from IPython.display import Image, display

# ワークフローを作成
workflow = create_analysis_workflow()

# グラフを可視化（Mermaid形式で出力）
graph = workflow.get_graph()
print("## 分析ワークフロー図")
print("```mermaid")
print(graph.draw_mermaid())
print("```")

# ---
# グラフを出力する
display(Image(workflow.get_graph().draw_mermaid_png()))

# ---
# 総合分析ワークフロー実行
workflow = create_analysis_workflow()
initial_state = AnalysisState(
    d1_summary=d1_summary,
    d9_summary=d9_summary,
    d60_summary=d60_summary,
    dasha_schedule_str=dasha_schedule_str,
    user_message=user_message
)
result = workflow.invoke(initial_state)

# ---
# 結果表示
print("\n## インド占星術による総合分析結果")
if result.get("full_result"):
    full_result = result["full_result"]
    print("### ハウス別分析:")
    for house in full_result.get("analysis", []):
       print(f"- {house['house']}: {house['interpretation']}")
    # ---
    print("\n### 総合評価:")
    oa = full_result.get("overall", {})
    print(f"性格: {oa.get('personality', '')}")
    print(f"能力: {oa.get('abilities', '')}")
    print(f"成果予測: {oa.get('achievements', '')}")
    print(f"2025-2040年の運勢: {oa.get('fortune_2025_2040', '')}")
else:
    print("分析に失敗しました")

```

D先生：“ほほう・・・。**ユーザーメッセージ**というのを新設しました。そこでは、なぜか**「某国」**になっています。国名を出してはいけないですか？”

QEU:FOUNDER ： “これはしょうがないんです。もし、具体的な国名を出すと、別のロジックが動いて予測をするかもしれません。経済予測のときに、経済学者がコメントするとかね・・・。我々は、単純に「占い」をしたいだけなんです。それでは、占いの結果をみてみましょう。”

## インド占星術による総合分析結果

### ハウス別分析:

- 1室: 外交的で調和を重んじる国民性。D60のケートゥは過去の戦争トラウマを暗示。2024年からの火星ダシャーでアイデンティティの再構築が急務。
- 2室: 月の情緒性と土星の制約が経済停滞の原因。資源管理の硬直化とバブル崩壊の後遺症が持続。D9土星は資産運用の見直し必要性を示唆。
- 3室: 木星の拡張性が技術革新を促進したが、D60木星減衰でイノベーション停滞。教育制度の刷新と国際協力が突破口。
- 4室: ケートゥの分離傾向が地方衰退を招く。火星の攻撃性で社会分断が進行。インフラ再整備と地域活性化が必須。
- 5室: ケートゥと土星が創造性を阻害。教育制度の硬直化が人材育成の妨げに。アート支援と起業家育成で活性化を。
- 6室: 水星の混乱が官僚制度の非効率化を招く。医療・福祉システムのデジタル化改革が腐敗防止に有効。
- 7室: ラーフの変動性で外交方針が不安定。火星ダシャー期(2024-31)は貿易摩擦リスク高。ASEAN諸国との多角化が安全弁に。
- 8室: 金星支配で変革抵抗強し。既得権益構造が政治刷新を阻害。2031年ラーフ期での大規模制度改革が転機。
- 9室: 火星の攻撃性が排外主義を助長。伝統と革新の調和が必要。東洋哲学を基盤とした新教育プログラム推奨。
- 10室: 土星-ラーフ-金星の複合が腐敗構造を形成。太陽減衰で指導力不足。女性リーダー登用とデジタルガバナンス導入を。
- 11室: 太陽の栄光追求がバブル招く。D9木星-ラーフで成長目標混乱。クリーンエネルギー産業へ投資転換を推奨。
- 12室: 水星-木星の矛盾が国民精神の荒廃招く。D9太陽減衰で国家プライド喪失。伝統文化再評価とメンタルヘルス対策が急務。

### 総合評価:

性格: 調和を尊ぶも自己変革が苦手。栄光への執着と現実回避傾向が硬直化を招く。国民の勤勉さは最大の強みだが、方向性の見失いが弱点。
能力: 高度な技術力と美的センスを保有。危機適応力は低いが、火星ダシャー期で行動力向上の可能性。
成果予測: 
2026-27年：火星/金星期で文化産業が復興
2030-31年：火星/水星期にデジタルガバメント実現
2035年：ラーフ/木星期でアジア新経済圏の主導権獲得
2025-2040年の運勢: 
◆2025-31年（火星ダシャー）：
- 政治刷新の機運高まるも既得権益層との対立激化
- 2027年頃にAIを活用した行政改革が突破口に
◆2031-40年（ラーフダシャー）：
- 大規模な社会システム再構築が進行
- 2033年頃に伝統産業のデジタル化が経済再生の起爆剤に

【災難回避策】

1. 排外主義対策：多文化共生プログラムの義務教育化
2. 腐敗防止：ブロックチェーン導入による公共調達透明化
3. 経済再生：量子技術・水素エネルギーへの集中投資
4. 精神性向上：禅と先端テクノロジー融合の精神医療システム開発

D先生：“まあ、この「おもちゃのようなプログラム」でも、もっともらしい結果がでてきますな。さすが、LLM・・・（笑）。”

QEU:FOUNDER ： “小生が見たいのは、むしろ、**「D60分割図の解釈そのもの」**です。そこで、D60 分割図を解釈するための**「専用プログラム]**
を作りました。それでは、おまけプログラムをドン！！”

```python
# ---
from langchain.prompts import (
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate,
    ChatPromptTemplate
)
from langchain_openai import ChatOpenAI

#def create_chat_with_context():
# システムメッセージ（AIの役割や予備知識を与える）
system_template = """あなたは優秀なインド占星術の占い師です。以下の会話履歴を踏まえて回答してください。
これまでの会話内容を理解し、文脈に沿った応答をしてください。"""
system_message = SystemMessagePromptTemplate.from_template(system_template)

# ---
# NO1
user_question_no1 = """インド占星術（ジョーティシュ）におけるD60分割図（Shashtiamsha、シャシュティアムシャ）について教えてください。"""
ai_answer_no1 = """**D60分割図とは**
- **定義**: D60は、出生図（D1、ラシ・チャート）をさらに細かく60等分した分割図（ヴァルガ・チャート）です。各サイン（星座）の30度を60等分するため、1つのD60の区間は0度30分（30分角）です。
- **目的**: D60は、個人の過去生のカルマ、潜在的な運命、微細な運勢の傾向を示します。インド占星術の古典『ブリハット・パラシャラ・ホーラ・シャーストラ』（Brihat Parashara Hora Shastra）では、D60はすべての分割図の中で最も重要なものの一つとされ、人生の深いカルマ的パターンを映し出すとされています。
- **計算**: 各惑星の度数を60倍し、12星座に割り当てます。例えば、太陽が牡羊座の10度にある場合、10 × 60 = 600度となり、これを12星座（360度）で割った余りで配置を決定します。さらに、D60の各区間には特定の「神々の名前」が割り当てられています。

"""
# ---
# NO2
user_question_no2 = """吉神（Deva）と凶神（Asura）の役割について教えてください。"""
ai_answer_no2 = """**吉神（Deva）と凶神（Asura）の役割**
D60分割図では、各0.5度（30分）の区間に60の「神々」（Shashtiamsha Deities）が割り当てられており、これが吉神（Deva）または凶神（Asura）に分類されます。これらの神々は、惑星がどの区間に位置するかによってその影響を特徴づけます。

1. **吉神（Deva）**:
   - 吉神は、ポジティブで調和的、保護的なエネルギーを象徴します。
   - 例: ヴィシュヌ（Vishnu）、ラクシュミ（Lakshmi）、ブラフマー（Brahma）など。これらの神々に支配された区間に惑星がある場合、その惑星はポジティブなカルマ的影響を持ち、成功、繁栄、精神性、保護をもたらす傾向があります。
   - 例えば、太陽が吉神の区間にある場合、個人の自己表現やリーダーシップが過去生の良いカルマによって強化される可能性があります。

2. **凶神（Asura）**:
   - 凶神は、挑戦的、破壊的、または試練をもたらすエネルギーを象徴します。
   - 例: ラークシャサ（Rakshasa）、ナーガ（Naga）、ピシャーチャ（Pishacha）など。これらの区間に惑星がある場合、その惑星に関連する領域で試練やカルマ的負債が現れる可能性があります。
   - 例えば、月が凶神の区間にある場合、感情面や心の安定において過去生の課題が影響する可能性があります。

3. **中間的な神々**:
   - 一部の神々は吉でも凶でもなく、中間的な性質を持ち、状況に応じて影響が変化します。

"""
# ---
# NO3
user_question_no3 = """D60の活用方法について教えてください。"""
ai_answer_no3 = """D60は非常に詳細な分割図であるため、以下のような具体的な用途で活用されます：

1. **過去生のカルマの解釈**  
   - D60は過去生のカルマが現在の人生にどう影響するかを示す。特定の惑星やハウスの配置から、過去生での行動や未解決のカルマを推測。
   - **例**: D60でラーフが凶神（Rakshasa）にあり、第8ハウスにある場合、過去生での欺瞞や未解決の執着が現在の試練につながっている可能性。

2. **運命の深いパターンの分析**  
   - D1やD9で明確でない運命の傾向を、D60で確認。D1で惑星が強くても、D60で弱い（凶神の影響下）場合、その惑星の結果が制限される。
   - **例**: D1で金星が高揚していても、D60で「Asura」にあれば、恋愛や結婚で対立や試練が生じやすい。

3. **ダシャーとの組み合わせ**  
   - ヴィムショッタリ・ダシャーのマハーダシャーやアンタルダシャーの結果をD60で精査。支配惑星がD60でどの神格やハウスにあるかで、ダシャー期間の吉凶を予測。
   - **例**: 木星マハーダシャー中にD60で木星が「Deva」にあれば、学問やスピリチュアルな成長が顕著になる。

4. **特定のイベントのタイミング**  
   - 大きな人生のイベント（結婚、転職、大きな成功や失敗）の背景をD60で分析。特に、D60のラグナや第10ハウス（キャリア）、第7ハウス（パートナーシップ）が重要。
   - **例**: D60の第7ハウスに吉神の影響を受けた金星があれば、結婚のタイミングで幸福な結果が期待できる。

5. **惑星の強さ（Vargottama）の確認**  
   - 惑星がD1と同じ星座にD60でも配置される場合（Vargottama）、その惑星の影響が非常に強くなる。D60でのVargottamaは、特にカルマ的な重要性を示す。
   - **例**: 太陽がD1とD60の両方で獅子座にあれば、名声やリーダーシップでの成功が強調される。

6. **トランジット（ゴーチャラ）との統合**  
   - D60の惑星配置とトランジットの惑星の動きを比較し、特定の時期の運気を詳細に予測。D60のラグナや重要なハウスを通過するトランジット惑星が吉凶を左右。
   - **例**: トランジットの木星がD60の第5ハウス（子供、創造性）を通過し、吉神に影響されている場合、子供の誕生や創造的な成功が期待できる。

"""

# ---
str_summary = """## D60（ショダシャムシャ）分割図のまとめ表
| ハウスNO | ハウスの星座 | ハウスの主管惑星 | 陰陽 | 活動/固定/変動 | 火/土/風/水 | 配置された惑星名と星位 | jagannatha hora |
| ------ | ---- | ------ | ---- | -----------| ------| ------|
| 1 | みずがめ座 | 天王星 | 陽 | 固定 | 風 | Ke:11.5,As:4.1 |     |
| 2 | うお座 | 木星 | 陰 | 変動 | 水 |  |   Ke  |
| 3 | おひつじ座 | 火星 | 陽 | 活動 | 火 | Mo:9.1,Ve:6.1 |   Su  |
| 4 | おうし座 | 金星 | 陰 | 固定 | 土 |  |     |
| 5 | ふたご座 | 水星 | 陽 | 変動 | 風 | Sa:18.2 |   Ju  |
| 6 | かに座 | 月 | 陰 | 活動 | 水 | Me:13.6 |     |
| 7 | しし座 | 太陽 | 陽 | 固定 | 火 | Ra:11.5 |   Ve  |
| 8 | おとめ座 | 水星 | 陰 | 変動 | 土 |  |   Ra  |
| 9 | てんびん座 | 金星 | 陽 | 活動 | 風 | Ma:13.3 |   Sa  |
| 10 | さそり座 | 冥王星 | 陰 | 固定 | 水 | Su:4.1 |   As  |
| 11 | いて座 | 木星 | 陽 | 変動 | 火 | Ju:0.0 |   Mo  |
| 12 | やぎ座 | 土星 | 陰 | 活動 | 土 |  |   Me,Ma  |

## D9（ナヴァムシャ）分割図のまとめ表
| ハウスNO | ハウスの星座 | ハウスの主管惑星 | 陰陽 | 活動/固定/変動 | 火/土/風/水 | 配置された惑星名と星位 |
| ------ | ---- | ------ | ---- | -----------| ------| ------|
| 1 | おとめ座 | 水星 | 陰 | 変動 | 土 | Ju:12.7,Ra:13.7,As:5.7 |
| 2 | てんびん座 | 金星 | 陽 | 活動 | 風 | Su:5.7,Ve:22.8 |
| 3 | さそり座 | 冥王星 | 陰 | 固定 | 水 | Mo:29.4 |
| 4 | いて座 | 木星 | 陽 | 変動 | 火 | Sa:24.1 |
| 5 | やぎ座 | 土星 | 陰 | 活動 | 土 | Me:13.1 |
| 6 | みずがめ座 | 天王星 | 陽 | 固定 | 風 | Ma:19.2 |
| 7 | うお座 | 木星 | 陰 | 変動 | 水 | Ke:13.7 |
| 8 | おひつじ座 | 火星 | 陽 | 活動 | 火 |  |
| 9 | おうし座 | 金星 | 陰 | 固定 | 土 |  |
| 10 | ふたご座 | 水星 | 陽 | 変動 | 風 |  |
| 11 | かに座 | 月 | 陰 | 活動 | 水 |  |
| 12 | しし座 | 太陽 | 陽 | 固定 | 火 |  |

## 出生(D1)図のまとめ表
| ハウスNO | ハウスの星座 | ハウスの主管惑星 | 陰陽 | 活動/固定/変動 | 火/土/風/水 | 配置された惑星名と星位 |
| ------ | ---- | ------ | ---- | -----------| ------| ------|
| 1 | うお座 | 木星 | 陰 | 変動 | 水 | As:20.6 |
| 2 | おひつじ座 | 火星 | 陽 | 活動 | 火 |  |
| 3 | おうし座 | 金星 | 陰 | 固定 | 土 |  |
| 4 | ふたご座 | 水星 | 陽 | 変動 | 風 | Ma:15.5 |
| 5 | かに座 | 月 | 陰 | 活動 | 水 | Ve:12.5,Sa:19.3,Ra:8.2 |
| 6 | しし座 | 太陽 | 陽 | 固定 | 火 | Su:20.6 |
| 7 | おとめ座 | 水星 | 陰 | 変動 | 土 | Me:1.5,Ju:28.1 |
| 8 | てんびん座 | 金星 | 陽 | 活動 | 風 |  |
| 9 | さそり座 | 冥王星 | 陰 | 固定 | 水 | Mo:16.6 |
| 10 | いて座 | 木星 | 陽 | 変動 | 火 |  |
| 11 | やぎ座 | 土星 | 陰 | 活動 | 土 | Ke:8.2 |
| 12 | みずがめ座 | 天王星 | 陽 | 固定 | 風 |  |

## ダシャースケジュール (出生から2040年)
| ダシャー | 開始日 | 終了日 | 期間(年) | 運勢の特徴 |
|---------|---------|---------|----------|------------|
| Sa | 1945-08-15 | 1964-08-10 | 19.0 | 土星ダシャー中は忍耐と努力が求められる時期。責任感が強まり、堅実な行動が吉。健康面や人間関係で慎重さが必要だが、長年の経験が支えに。地道な積み重ねが実を結ぶ時。 |
| Me | 1964-08-10 | 1981-08-06 | 17 | 水星ダシャー中はコミュニケーション能力が向上し、知的な活動に恵まれます。土星の影響で慎重さも求められますが、経験を活かしたアドバイスが評価される時期です。健康管理に注意しましょう。 |
| Ke | 1981-08-06 | 1988-08-04 | 7 | ケートゥのダシャー期間は、精神的な成長と内省の時期。土星の影響で忍耐力が試されるが、過去の経験が支えに。健康面に注意しつつ、静かな充実を求める時期です。 |
| Ve | 1988-08-04 | 2008-07-30 | 20 | 金星ダシャー中は、芸術や人間関係に恵まれますが、土星の影響で慎重さが必要。安定を求める傾向が強まり、物質的な豊かさと精神的な充足のバランスが鍵となります。 |
| Su | 2008-07-30 | 2014-07-29 | 6 | 太陽ダシャー中は社会的評価やリーダーシップが強調されます。土星の影響で慎重な行動が求められますが、経験を活かした指導力が発揮できる時期です。健康管理に注意しつつ、円熟した知恵を周囲と共有すると良いでしょう。 |
| Mo | 2014-07-29 | 2024-07-26 | 10 | 現在の月ダシャーは感情面や家庭運に影響。アヌラーダナクシャトラの土星の影響で慎重さが求められる時期。精神的安定を重視し、過去の経験を活かすことが吉。健康管理にも注意。 |
| Ma | 2024-07-26 | 2031-07-25 | 7 | 火星ダシャー中は情熱と行動力が高まり、挑戦的な活動に積極的。土星の影響で忍耐力も発揮されますが、健康面や人間関係で注意が必要。短期決断より慎重な計画が吉。 |
| Ra | 2031-07-25 | 2040-07-22 | 9.0 | ラーフ期は予期せぬ変化や精神的な成長をもたらす時期。土星の影響で忍耐力が試されるが、社会的評価が向上する可能性も。高齢期の転換点として、内省と適応が鍵。 |

"""

# -----
# これまでのユーザーとAIの会話（予備知識として与える）
conversation_history = [
    {"role": "user", "content": user_question_no1},
    {"role": "assistant", "content": ai_answer_no1},
    {"role": "user", "content": user_question_no2},
    {"role": "assistant", "content": ai_answer_no2},
    {"role": "user", "content": user_question_no3},
    {"role": "assistant", "content": ai_answer_no3}
]

# ---
# 人間メッセージテンプレートに会話履歴をテキスト化して渡す
human_template = """
これまでの会話履歴:
{history}

{str_summary}

以下のユーザーの質問に答えてください。
{user_question}
"""
# 会話履歴を整形
history_text = "\n".join([f"{msg['role']}: {msg['content']}" for msg in conversation_history])
human_message = HumanMessagePromptTemplate.from_template(human_template)

# チャットプロンプトを作成
chat_prompt = ChatPromptTemplate.from_messages([system_message, human_message])

# LLMインスタンスを作成（OpenAI APIキーは環境変数で設定済み）
#llm = ChatOpenAI(model="gpt-4", temperature=0.7)
"""LLMでダシャーまたはアンタルダシャーの運勢コメントを生成"""
llm = ChatOpenAI(
    model="deepseek-reasoner",
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url="https://api.deepseek.com",
    temperature=0.3
)

# ---
# 新しい質問
user_question = """上記のD1,D9及びD60分割図をもつ人(当人)の特性、能力、運命とカルマについて、主にD60分割図の解釈に重点をおいて説明してください。
以下の情報を含むこと:
- 当人の性格
- 当人が行ってきた事柄について、成果と問題点
- 対人関係
- 富と名誉
- 当人が前世から得たギフト
- 当人が前世から引き継いだカルマ
- 当人が、ギフトとカルマから見て、今世でやるべきこと
- 2025年から2030年までの運勢
"""

# プロンプトに会話履歴を注入して生成
response = llm.invoke(chat_prompt.format_messages(history=history_text, str_summary=str_summary, user_question=user_question))

print("AIの回答:")
print(response.content)

```

QEU:FOUNDER ： “LLMの**会話履歴という手法**を用いて、外部からAIに知識を注入する手法を用いました。はたして、このAIにどれだけの関連知識があるのか、わからないですからね。それでは、我らが**「某国の徳とカルマ」**に集中した占いの結果を見てみましょう。まずは前半です。どうやら、聞こえが良いことを中心に書いています。”

**(某国の徳とカルマを中心に占ってみた)**

以下に、提供されたD1（出生図）、D9（ナヴァムシャ図）、およびD60（シャシュティアムシャ図）に基づいて、当人の特性、能力、運命とカルマについて分析します。D60分割図は「シャシュティアムシャ」とも呼ばれ、出生図を60分割した微細なチャートで、過去生のカルマ、潜在的な運命のパターン、および人生の深層的な傾向を明らかにします。特に、D60では各惑星が配置された区間に「吉神（Deva）」または「凶神（Asura）」が割り当てられており、これが惑星の影響を強化または弱化させます（例：吉神はポジティブなカルマ的恩恵、凶神は試練やカルマ的負債を示唆）。分析では、D60を中心に据えつつ、D1やD9と統合して解釈します。

### 基本方針

- **D60の重要性**: D60は、過去生のカルマが現在の人生にどのように影響するかを示す「カルマの青写真」です。惑星が吉神（Deva）の区間にある場合は過去生の善行による恩恵、凶神（Asura）の区間にある場合は未解決の課題を反映します。提供されたD60表では、各ハウスの惑星配置と「jagannatha hora」列（惑星の位置補完）から、吉凶を推測します（例：太陽が第10ハウスで「As」と記載されているのは凶神の影響を示唆）。

- **統合的解釈**: D1（現実的な人生の基盤）、D9（精神性や運命の方向性）とD60を組み合わせ、一貫性のあるパターンを抽出します。特にD60のラグナ（アセンダント）はみずがめ座で、天王星が主管惑星。これは革新性と精神性を強調しますが、ケートゥの影響で孤独感やカルマ的課題が顕著です。
- **キーポイント**: 当人の人生は、過去生から引き継いだ「ギフト」（強み）と「カルマ」（課題）のバランスが重要です。ギフトを活かすことでカルマを浄化でき、特にD60はそのプロセスを詳細に示します。

### 1. 当人の性格（D60を中心に）

D60ラグナ（第1ハウス）はみずがめ座で、天王星が主管惑星。これは「風」元素、「固定」宮、「陽」の性質を持つため、基本的な性格は革新的で独立心が強く、人道主義的です。しかし、D60第1ハウスにケートゥ（Ke）とアセンダント（As）が配置されており、凶神（Asura）の影響が強い（ケートゥは分離と精神性を象徴）。これにより、以下の特性が現れます：

- **強み**: 直観力が鋭く、未来志向（みずがめ座の革新性）。第3ハウスに月と金星が配置（おひつじ座、火星主管）されており、コミュニケーション能力や情熱が高い。特に金星が吉神（Deva）の可能性がある（古典的解釈では、金星の位置によっては調和的）ため、芸術的センスや共感力に恵まれます。
- **弱み**: ケートゥの凶神影響で感情的距離を置きがちで、孤立感や自己不信が強い。D1ラグナがうお座（感受性豊か）やD9ラグナがおとめ座（分析的）と統合すると、内面的には敏感だが、表向きは冷静で論理的になる二面性があります。
- **D60に基づくカルマ的影響**: 過去生で「独立を求めるが故の孤独」を経験しており、今生では人間関係での距離感が課題。吉神の木星が第11ハウスにあり（いて座）、楽観性や社会的関心はあるものの、第1ハウスのケートゥがそれを阻みます。

### 2. 当人が行ってきた事柄について、成果と問題点

D60は、過去生のカルマが現実の行動や結果にどう影響するかを示します。特に第5ハウス（創造性）、第10ハウス（キャリア）、第7ハウス（パートナーシップ）の配置が重要です。

- **成果**:
  - **創造的・知的活動**: D60第3ハウスに月と金星（おひつじ座）が配置され、吉神の影響が推測されます（金星は愛と調和の惑星）。これにより、コミュニケーションや芸術分野（例：執筆、音楽、教育）で才能を発揮し、情熱的なアプローチで成果を上げてきた。D1第5ハウスに金星、土星、ラーフが配置（かに座）されており、遅咲きながらもユニークな創造性が認められる（例：中高年期での芸術的達成）。
  - **社会的貢献**: D60第11ハウスに木星が配置（いて座、0.0度）され、吉神（Deva）の影響が強い。過去生での善行による恩恵で、友人やネットワークを通じた成功（例：コミュニティ活動、ボランティア）が顕著。ダシャースケジュールでも、金星ダシャー（1988-2008年）や月ダシャー（2014-2024年）で社会的評価を得ています。
- **問題点**:
  - **創造性の制限**: D60第5ハウスに土星が配置（ふたご座、18.2度）され、凶神（Asura）の影響が推測されます（土星は制限と責任）。過去生で創造性を抑圧したカルマがあり、今生ではアイデアが実現しにくい、子供関連の課題（例：子育ての困難）、または恋愛での挫折を経験。
  - **キャリアの試練**: D60第10ハウスに太陽が配置（さそり座、4.1度）され、凶神（「As」明記）の影響。権威への反抗や過去生での失敗が反映され、キャリアで不本意な変化や評価の遅れ（例：太陽ダシャー（2008-2014年）での努力が報われない時期）があった。D1第6ハウスに太陽（獅子座）があるため、健康問題がキャリアを阻害することも。
  - **人間関係の不安定性**: D60第7ハウスにラーフが配置（しし座、11.5度）され、凶神（Asura）の影響。パートナーシップで幻想や裏切りを経験しやすく、D9第1ハウスにラーフとケートゥが配置（おとめ座）されていることから、自己と他者の境界が曖昧でトラブルを招く。

### 3. 対人関係

D60の第7ハウス（パートナーシップ）、第11ハウス（友人）、第3ハウス（コミュニケーション）が中心です。

- **パートナーシップ**: D60第7ハウスにラーフ（凶神影響）があり、しし座（太陽主管）のため、恋愛や結婚で「理想と現実のギャップ」が生じやすい。相手を過大評価したり、支配的な関係になりがち。D1第7ハウスに水星と木星（おとめ座）があるため、知的パートナーとは相性が良いが、D60のラーフがそれを乱します。
- **友人・ネットワーク**: D60第11ハウスに木星（吉神影響）があり、いて座で強力。友人やグループから大きな支援を得られ、社会的なつながりで成功（例：ビジネスパートナーシップ）を築ける。木星の恩恵で、困った時に助けられる傾向。
- **家族・コミュニケーション**: D60第3ハウスに月と金星があり、兄弟や近親者との関係は良好。しかし、月がおひつじ座（火星主管）で凶神の可能性があるため、感情的な衝突が起こりやすい。D4（家族図）がなく、D60第4ハウス（家庭）に惑星がないことから、家庭環境は安定しているが、情緒的な距離感がある。

### 4. 富と名誉

D60第2ハウス（富）、第10ハウス（名誉）、第11ハウス（収入）を分析。

- **富（財産・収入）**: D60第2ハウスにケートゥが配置（うお座、Jagannatha Horaから推測）され、凶神影響。財産が不安定で、浪費や予期せぬ出費が課題。ただし、D1第2ハウスがおひつじ座（火星主管）で空であるため、努力で収入を得られるが、蓄財に苦労。
- **名誉（キャリア・社会的評価）**: D60第10ハウスに太陽が凶神影響で配置（さそり座）。キャリアで試練（例：競争での敗北、評価の遅れ）があり、D1第10ハウスがいて座（木星主管）で空なことから、潜在的な名声はあるが、実現には時間がかかる。吉神の木星が第11ハウスにあるため、ネットワークを通じた間接的な評価（例：表彰や推薦）で名誉を得る。
- **統合的解釈**: 富は不安定だが、名誉は社会的貢献で築ける。ダシャースケジュールでは、火星ダシャー（2024-2031年）で行動力が高まり、収入増加の可能性。

### 5. 当人が前世から得たギフト

D60の吉神影響の配置から、過去生の善行による恩恵を読み取ります。

- **精神的ネットワーク（木星第11ハウス）**: D60第11ハウスに木星がいて座で配置され、吉神（Deva）の影響。過去生で社会奉献や知的な交流を積んだため、今生では友人やメンターから助けられ、集団での成功が容易。特に教育・スピリチュアル分野でギフトが発揮。
- **コミュニケーションと芸術性（月と金星第3ハウス）**: 第3ハウスに月と金星が配置され、吉神の可能性。過去生で言葉や芸術を使った奉仕（例：教師や芸術家）をしたため、今生で説得力や創造的表現力が高い。D1第5ハウスの金星とも連動し、趣味や子育てで喜びを得られる。
- **革新と直観（ラグナのみずがめ座）**: 天王星主管で、過去生での先見性が直観力として継承。時代を先取りするアイデア（例：テクノロジーや社会改革）に恵まれる。

D先生： “なんか、この方は、創造性が高いらしいですね。あ～あ、財産が不安定なのですね。“

QEU:FOUNDER ： “その一方で、「友人・ネットワーク」の運勢は、かなりいいんですよ。それでは後半にいくよ！！”

### 6. 当人が前世から引き継いだカルマ
D60の凶神影響の配置から、過去生の未解決の課題を特定します。
- **孤独と分離（ケートゥ第1ハウス）**: D60第1ハウスにケートゥが凶神影響で配置。過去生で独立を重視し過ぎて人間関係を疎かにしたカルマがあり、今生でも孤立感や自己不信が強い。精神的成長の機会を逃しやすい。
- **創造性の制限（土星第5ハウス）**: 第5ハウスに土星が凶神影響で配置。過去生で創造性を抑圧したため、今生で自己表現のブロック（例：アイデアが実現しない）が発生。
- **権威への反抗（太陽第10ハウス凶神）**: 第10ハウスの太陽が凶神影響。過去生で権力と衝突したり、キャリアを放棄したカルマがあり、今生で社会的評価を得るのに苦労（例：上司との対立、キャリアチェンジの失敗）。
- **パートナーシップの幻想（ラーフ第7ハウス）**: ラーフが凶神影響で、過去生での不実な関係が反映。今生でパートナーに依存したり、理想的な関係を求め過ぎる傾向。

### 7. 当人が、ギフトとカルマから見てやるべきこと
D60のカルマ的パターンを浄化し、ギフトを活かすための具体的行動を提案。インド占星術では、惑星の影響をバランスさせることが重要です。
- **ギフトを活用する行動**:
  - **社会的ネットワークの構築**: 木星第11ハウスの恩恵を活かし、友人やグループ活動（例：ボランティア、オンラインコミュニティ）に参加。これにより、孤独感（ケートゥ第1ハウス）を和らげ、富と名誉を高める。
  - **創造的表現の促進**: 月と金星第3ハウスのギフトで、コミュニケーションや芸術をツールに（例：ブログ執筆、アートセラピー）。土星第5ハウスのカルマを乗り越えるため、小さな創造的プロジェクトから始め、継続的に発表。
- **カルマの解消**:
  - **スピリチュアル実践**: ケートゥ第1ハウスのカルマを浄化するため、瞑想やヨガで内省を深める。過去生の分離を癒すことで、人間関係の距離感を改善。
  - **責任ある創造性**: 土星第5ハウスの影響に対抗し、創造性に「構造」を与える（例：定期的な作品制作、子供や若者への指導）。これにより、カルマ的負債を軽減。
  - **権威との調和**: 太陽第10ハウスの凶神影響を和らげるため、キャリアで協調性を重視（例：メンターを探す、チームワークを強化）。D9第10ハウスが空なことから、謙虚な姿勢が評価を呼ぶ。
- **全般的アドバイス**: D60の風元素（みずがめ座ラグナ）を活かし、革新的なアイデアで社会貢献を。年齢的にはダシャースケジュールから、現在の月ダシャー（2014-2024年）では内省を、火星ダシャー（2024-2031年）では行動を重視。

### 8. 2025年から2030年までの運勢
ダシャースケジュールによると、この期間は火星ダシャー（2024年7月～2031年7月）に該当します。D60図とトランジットを統合して予測。火星はD60第9ハウスに配置（てんびん座、13.3度）され、凶神（Asura）の影響が推測されます（火星は攻撃性と行動力）。古典的解釈では、第9ハウスは運命、スピリチュアル、外国を表し、火星があると挑戦的です。
- **全般的傾向**: 火星ダシャーはエネルギーが高まり、新しい挑戦（例：起業、旅行、学問）が活発化。しかし、凶神影響で衝動的な行動によるトラブル（人間関係の衝突、健康問題）が懸念。D1で火星が第4ハウス（家庭）、D9で第6ハウス（健康）にあるため、家庭や身体に注意が必要。2025-2030年は、努力で成果を得られるが、忍耐が鍵。
- **年別のハイライト（トランジットを考慮）**:
  - **2025年**: トランジット木星がいて座（D60第11ハウス）を通過。木星の吉神恩恵で、ネットワークや収入が拡大。火星ダシャーの開始年として、ビジネスやプロジェクトを始める好機。
  - **2026-2027年**: トランジット土星がみずがめ座（D60ラグナ）に。責任が増し、孤独感が強まるが、スピリチュアル実践で成長。D60第10ハウスの太陽凶神影響で、キャリアでの競争が激化。
  - **2028-2029年**: トランジットラーフがしし座（D60第7ハウス）付近に。パートナーシップで誤解や変化が生じやすい。火星の影響で海外関連（旅行や学び）にチャンス。
  - **2030年**: トランジット木星がやぎ座（D60第12ハウス）に。損失や内省の時期だが、D60第12ハウスに水星と火星（Jagannatha Horaから推測）があるため、創造的な活動で精神性を高める。
- **アドバイス**: 火星の凶神影響を軽減するため、スポーツや身体活動でエネルギーを発散。第9ハウスの意味を活かし、スピリチュアルな学び（例：占星術、哲学）に取り組むことで、カルマを浄化。富と名誉は、2025-2027年に努力が実り始め、2030年までに社会的評価が安定。

### まとめ
当人は、D60図から、過去生で培ったネットワークやコミュニケーション能力（ギフト）に恵まれつつも、孤独感や創造性の制限（カルマ）を引き継いでいます。今生の課題は、これらのカルマをギフトでバランスさせること。特に2025-2030年の火星ダシャーは変革の時期で、行動力で成功を掴めるが、衝動を抑え、スピリチュアルな成長を重視すべきです。インド占星術の観点では、惑星のポジティブな影響を強化するため、定期的な瞑想や慈悲の行い（ダーナ）が推奨されます。必要に応じ、特定の惑星（例：土星や太陽）の宝石やマントラを専門家と相談してください。

D先生： “たしかに・・・。**「孤独」と「創造性の制限」というカルマ**かあ・・・。きっと、**差別が好きな人**なんでしょう。**「パートナーシップへの幻想」**というのも、深く納得がいきます。この幻想が、本来の友好のメリットをダメにしているようです。う～ん・・・。ありがち・・・。 “

QEU:FOUNDER  ： “現在は火星の支配の時期だから、衝動的な行動に注意らしいです。”

D先生： “おもしろいですねえ。この占い・・・。 “

QEU:FOUNDER  ： “いや、つまらない。もう、こんなものを終わらせたいと思います。その理由は、まとめにつづく・・・。”


## ～ まとめ ～

### ・・・ これって、とっても「非人間的」だよ ・・・

C部長： “あれ？せっかく、ここまでやったのに、ここでソフトの開発をめちゃうんですか？”

[![MOVIE1](http://img.youtube.com/vi/fiMgwrGrd38/0.jpg)](http://www.youtube.com/watch?v=fiMgwrGrd38 "過去からの"カルマ"を解消するにはどうする!?｢インド占星術｣をもっと深堀り！！")

QEU:FOUNDER ： “この占いって、世のため、人のためには良くないですよ。いっそ、こんなものを使うのはやめるべきです。西洋占星術の方が、まだ無害ですよ。その一方で、あれには益もないかもしれないですが・・・（笑）。”

D先生： “ずいぶん、この占いを嫌いますね。”

QEU:FOUNDER ： “この占いの本場のI国では、出産のときに帝王切開が流行っています。つまり、**運勢が良い時間にむりやり出産させる**んです。ホント、そこまでしなきゃいかんのか？そもそも、ACID_ATTACKで有名なように、女性に対して極めて厳しい社会なのに・・・。あとね、これからの社会において、カルマのような受動的な考え方って意味がどれだけあるの？時代は、カーストの正反対に向かっています。”

![imageINDS1-12-3](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-3.jpg) 

D先生：“AI時代のキャリア、仕事って、どうなるんでしょうね？”

![imageINDS1-12-4](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-4.jpg) 

QEU:FOUNDER ： “少なくとも、今後は仕事が1つだけというのは、もうあり得ないですね。1つの仕事に対して、**「人生の全体重を掛ける」**というスタイルは、とても危険でありえないです。AIの時代は、「どのように学ぶか？」は問題ではなく、「何を学ぶか？」、さらに言うと「それを学んで楽しいか？」が問題です。”

![imageINDS1-12-5](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-5.jpg) 

D先生：“すでに、若い人は気が付いているようです。彼らは、とても賢い。退職代行も、うまく使いこなします。”

![imageINDS1-12-6](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-6.jpg) 

QEU:FOUNDER ： “直接的には、**キャリアを見るD10 分割図の見方が今後は徹底的に変わる**と思います。その一方で、**出生の時間を不要にしたい方がいい**と思うんです。”


C部長：“そんなことを言ったら、根本的な部分を占うことができないじゃないですか？”

![imageINDS1-12-7](/2025-07-16-QEUR23_INDHS21/imageINDS1-12-7.jpg) 

QEU:FOUNDER ： “ユーザーが自由に出生時間を選んでもいいんじゃないですか？それが嫌ならば、自分が目指したい人の時間をもらうとか・・・。ともあれ、今回は参議院議員選挙記念の特別イベントです。**妙にスピリチャルな人を選ぶより、LLMでスピリチャルを遊んでもらい、正気を取り戻してほしい**という・・・。”
