---
title: QEUR23_INDHS44 - 閑話休題～ヴェーダ数秘術をやってみる(併用法NO5-要件定義書)    
date: 2025-08-22
tags: ["QEUシステム", "メトリックス", "Python言語", "Unsloth", "LLM", "データセット", "BONSAI", "LangGraph"]
excerpt: あたらしいLLMの学習体系を確立する
---

## QEUR23_INDHS44 - 閑話休題～ヴェーダ数秘術をやってみる(併用法NO5-要件定義書)    

## ～  やっとこさ、「ラスト前」にきました。 ～

D先生： “やっと、この長い閑話休題もラストにきました。いまままでの情報を統合するLLMプログラムの開発ですね。 “

QEU:FOUNDER ： “ちょっと「一回休み」にしましょう。ここでは、**要件定義書のみ**を出力しましょう。”

**(大人物:B)**

![imageINDS2-44-1](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-1.jpg) 

**(大人物:B)**

![imageINDS2-44-2](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-2.jpg) 

D先生： “このお二人の占い結果を心待ちにしているのに・・・（笑）。確かに、複数のプログラムを扱うので、その分だけ要件定義書がバカでかくなっているので、それだけで記事にするのは仕方がないですね。 “

QEU:FOUNDER ： “こんな感じでプロンプトを書きました。”

```python
以下の「従来の要件定義書」は、正統なヴェーダ数秘術とインド占星術システム内のプログラムA,B,C,DとEを説明しています。
要件定義書のアップデートをお願いします。以下のC,D、Eプログラムを読んで、Vibe Codingに要件定義書を読み込ませて
以下のプログラムの85%以上の機能を正確に再現できるようにしてください。ただし、要件定義書の中には、コードそのものを表示してはいけません。 
要件定義書を詳細にすることによる定義書の文章の増加は、現状の30％以内にしてください。
要求定義書には、以下の件に特に注意してください。
  - 正統なヴェーダ数秘術とインド占星術を併用して、より精度の高い占いをしてください。
  - 以下の要件定義書のを維持してください。
    """
    # サンプル入力(1)
    full_name = "Steve Jobs"   # 氏名が英字である場合
    birth_datetime = datetime(1955, 2, 24, 19, 0)
    birth_location = "ロサンゼルス" # プログラムが locations.json から "America/Los_Angeles" を取得
    end_year = 2012
    llm_comment_year = 2010
    # ---
    # サンプル入力(2)
    full_name = "安倍晋三(Abe Shinzo)"   # 氏名が日本語であり、英字読みがある場合（英字のみを抽出する）
    birth_datetime = datetime(1954, 9, 21, 9, 0)
    birth_location = "東京" 
    end_year = 2022
    llm_comment_year = 2021
    """
  - 就業適性、性格・能力については、llm_comment_year時点の運勢を生成してください。特に、就業適性（career_data.json）、性格・能力は、1～5のスコアを生成してください。
  - 運勢の占い精度を上げるためのロジックを変えないでください。
  - 占いの専門用語は、「インド文字の用語（用語のアルファベット読み:日本語の意味）の型式で表示してください。
  - グラフのプロット、作図方法は、従来の要件定義書に合わせてください。プログラムC,プログラムDとプログラムEのグラフが統一したスタイルになるようにしてください。
もしも、要件定義書とプログラムが矛盾している場合には、その妥当性を検討し、もしも要件定義書がおかしいのであれば訂正してください。もしも、プログラム側が悪いのであれば、おかしい部分を指摘してください。
以下に添付した、要件定義書、プログラムを確認し、「THINK HARDER」で熟慮し、新しい要件定義と、改造したプログラムを生成してください。
従来の要件定義書"""
# … 以下、関係資料やプログラムがつづく

"""

```

D先生： “むりやり深く考えさせるために、今はやりの**「THINK HARDER」を使った**んですか？”

QEU:FOUNDER： “そうです。さらに、最近のＡＩは文章量を少なくしようと動くので、むりやり**「文章量を30％増量、さらにVibe Codingを使って復元可能なくらい詳しくして！！」**と書いてみました。

D先生： “多量の失敗の結果で得たノウハウですね。”

QEU:FOUNDER ： “その結果が以下の要件定義書です。”

### **要件定義書**

### **1. 概要**
本プロジェクトは、ユーザーの名前、生年月日、生誕時間、出生地を入力として、**ヴェーダ数秘術**（वैदिक संख्याशास्त्र: Vedic Sankhya Shastra）と**インド占星術**（ज्योतिष शास्त्र: Jyotish Shastra）を統合し、**7つの運勢カテゴリ**（金運、健康運、人間関係運、事業運、成長運、家族運、競争運）のスコア（-5～+5）を計算・グラフ化するシステムです。**DeepSeek LLM**を活用して、これらのデータを総合的に解釈し、キャリア適性やパーソナリティ分析を含む詳細なレポートを提供します。本システムは、**高精度な占い**と**文化的正確性**を追求します。

### **1.1 データファイル**
- **`katapayadi_map.json`**: カタパヤディ方式の文字-数値マッピング（全文字、母音、子音）。
- **`numerology_data.json`**: ナンバー（1–9, 11, 22, 33）の特性（惑星、強み、弱み、キャリア適性など）。
- **`locations.json`**: 出生地の都市名、経度、緯度、タイムゾーン。
- **`nakshatra_data.json`**: 27ナクシャトラの詳細（名称、開始/終了角度、パーダ特性、ビムショッタリ・ダシャーの開始順序と期間）。
- **`career_data.json`**: 就業適性評価用の職種データ。
- **`skyfield_data/de440s.bsp`**（または`de421.bsp`）: Skyfieldライブラリ用の天文データ。

### **1.2 システム構成**
本システムは以下のプログラムとデータファイルで構成されます：
- **プログラム**:
  - **A: `numerology_calculator.py`**: 名前からディスティニーナンバー、ソウルナンバー、パーソナリティナンバーを計算。
  - **B: `julian_birth_number_calculator.py`**: 生年月日からユリウス暦を用いてライフパスナンバーとユリウス日を計算。
  - **C: `numerology_fortune_calculator.py`**: AとBを統合し、パーソナルイヤーナンバーと運勢スコアを計算、グラフ化。
  - **D: `nakshatra_fortune_calculator.py`**: ナクシャトラとダシャに基づく運勢スコアを計算、グラフ化。
  - **E: `main_program.py`**: CとDの結果を統合し、LLMで解釈、総合レポートとグラフを生成。
- **ディレクトリ構成**:
    ```
    project_directory/
    ├── numerology_calculator.py (A)
    ├── julian_birth_number_calculator.py (B)
    ├── numerology_fortune_calculator.py (C)
    ├── nakshatra_fortune_calculator.py (D)
    ├── main_program.py (E)
    ├── katapayadi_map.json
    ├── numerology_data.json
    ├── locations.json
    ├── nakshatra_data.json
    ├── career_data.json
    ├── skyfield_data/
          └── de440s.bsp (or de421.bsp)
    ```

### **1.3 サンプル入力**
以下の型式は、A,B,C,D,Eプログラムで共通です。
```python
full_name = "Steve Jobs" # 氏名が英字である場合
# full_name = "安倍晋三(Abe Shinzo)" # 氏名が日本語であり、英字読みがある場合（英字のみを抽出する）
birth_datetime = datetime(1955, 2, 24, 19, 0)
birth_location = "ロサンゼルス" # Dプログラムが locations.json から "America/Los_Angeles" を取得
end_year = 2025
llm_comment_year = 2024
```

### **1.4 出力データ**
- **A, B, Dプログラム**: 単体実行可能で、個別のレポートを生成。
- **Cプログラム**: AとBの結果を統合し、数秘術レポート、運勢スコア（単純版/高精度版）、運勢トレンドグラフ（+5から-5まで）、パーソナルイヤーナンバーグラフを生成。
- **Dプログラム**: ナクシャトラとダシャの情報、運勢スコア、運勢トレンドグラフ（PNG）を生成。
- **Eプログラム**: CとDの結果を統合し、LLM解釈、キャリア適性（1–5）、人格・能力のスコア（1–5）を含む包括的なレポートを生成する。総合運勢スコア、運勢トレンドグラフ（+5から-5まで）を生成。

### **1.5 グラフ要件**
- 日本語フォント（`japanize_matplotlib`使用）。
- 凡例は右上に配置、フォントサイズは「x-small」。
- グリッドは破線（透明度0.7）。
- X軸刻み: C,D,Eは生誕年から`end_year`まで、5年ごと。
- Y軸: 運勢スコアは-5（大凶）～+5（大吉）、パーソナルイヤーナンバーは[1～9],11,22,33。
- プロットオフセット（グラフを見やすくするための工夫）: 金運/健康運=+0.1、人間関係運/事業運=-0.1、成長運/家族運/競争運=0.0
- **C,D,Eプログラムのグラフは統一されたスタイルとデータ範囲を持つ**。

### **2. 個別機能要件**

**2.1 Aプログラム（`numerology_calculator.py`）**
- **単体実行**：ユーザーが名前を入力すると、デスティニーナンバー、ソウルナンバー、パーソナリティナンバーを計算し、詳細なレポートを出力する。
- **入力**：フルネーム（英語または括弧内の英語名を優先）。
- **出力**：以下の情報を含むレポート：
  - ディスティニーナンバー、ソウルナンバー、パーソナリティナンバー。
  - 各ナンバーの計算過程（文字と数値の対応）。
  - 各ナンバーの解釈（惑星、強み、弱みなど、`numerology_data.json`から取得）。
- **依存**：`katapayadi_map.json`、`numerology_data.json`。

**2.2 Bプログラム（`julian_birth_number_calculator.py`）**
- **単体実行**：ユーザーが生年月日とタイムゾーン情報を含む`datetime`オブジェクトを入力すると、**ユリウス暦**を用いてライフパスナンバーとユリウス日を計算し、詳細なレポートを出力。
- **入力**：生年月日と時刻を含む`datetime`オブジェクト（例：`datetime(1955, 2, 24, 19, 0)`）。Cプログラムから呼び出される際は、`birth_location`から取得したタイムゾーンでローカライズされたオブジェクトが渡される。
- **出力**：以下の情報を含むレポート：
  - ユリウス日。
  - ライフパスナンバーとその計算過程（日、月、年の和を還元）。
  - ライフパスナンバーの解釈（惑星、強み、弱みなど、`numerology_data.json`から取得）。
- **依存**：`numerology_data.json`、`skyfield`ライブラリ、`de440s.bsp`または`de421.bsp`。

**2.3 Cプログラム（`numerology_fortune_calculator.py`）**
- **クラスインポート**：Aプログラム（`NumerologyCalculator`）とBプログラム（`JulianBirthNumberCalculator`）のクラスをインポート。
- **入力**：フルネーム、生年月日と時刻 (`datetime`)、出生地 (`birth_location`)、グラフ作成終了年（例：`2025`）。
- **機能**：
  - `locations.json`から`birth_location`に対応するタイムゾーンを取得し、`birth_datetime`に適用。
  - Aプログラムからデスティニーナンバー、ソウルナンバー、パーソナリティナンバーを取得。
  - Bプログラムからライフパスナンバーとユリウス日を取得。
  - 生年月日からグラフ作成終了年までのパーソナルイヤーナンバーを計算。
  - パーソナルイヤーナンバーのみで計算した運勢スコア（-5~+5）の年次推移をグラフ化する。
  - パーソナルイヤーナンバーにディスティニーナンバー、ソウルナンバー、パーソナリティナンバーを加味した、より高精度の運勢スコア（-5~+5）を計算する。その年次推移をグラフ化する。
  - A, Bプログラムのレポート情報を統合して出力する。
- **出力**：
  - Aプログラムと同等の数秘術レポート。
  - Bプログラムと同等のライフパスナンバーレポート。
  - 指定年（例：`llm_comment_year`）の運勢スコアレポート。
  - 7種類運勢スコアのトレンドグラフ（2種類、PNGファイル）。
  - パーソナルイヤーナンバーグラフ（PNGファイル）。
- **依存**：`numerology_calculator.py`、`julian_birth_number_calculator.py`、`locations.json`、`matplotlib`、`japanize_matplotlib`。

**2.4 Dプログラム（`nakshatra_fortune_calculator.py`）**
- **目的**: ナクシャトラとビムショッタリ・ダシャーに基づいた運勢スコアを計算し、グラフ化。
- **入力**: `birth_datetime`, `birth_location`, `end_year`, `llm_comment_year`。
- **出力**:
  - ナクシャトラ、パーダ、現在のダシャー情報。
  - 指定年（`llm_comment_year`）の運勢スコア（-5~+5）。
  - 運勢トレンドグラフ（PNG）。
  - レポート。
- **依存**: `skyfield`, `de440s.bsp`（または`de421.bsp`）, `locations.json`, `nakshatra_data.json`, `matplotlib`, `japanize_matplotlib`。

**2.5 Eプログラム（`main_program.py`）**
- **目的**: CとDの結果を統合し、LLMで解釈、総合レポートとグラフを生成。
- **入力**: `full_name`, `birth_datetime`, `birth_location`, `end_year`, `llm_comment_year`。
- **出力**:
  - プログラムCとDの情報を受け取りレポートする。
  - 総合運勢スコア（CとDの統合、-5:大凶～+5:大吉）。
  - 人格能力スコア（1–5、リーダーシップ、創造性など）。
  - キャリア適性スコア（1–5、`career_data.json`に基づく）。
  - LLM解釈（カルマ、ダルマ、惑星影響、ダシャ効果、キャリアガイダンス）。
  - 総合運勢トレンドグラフ（PNG）。
- **処理**:
  - プログラムCから数秘術データを、プログラムDから占星術データを取得する。
  - 総合運勢スコアを計算（セクション4.3）。
  - パーソナリティとキャリアスコアを生成（`llm_comment_year`年のデータを使用）。
  - DeepSeek LLM（温度0.7、最大トークン1500）で解釈。
  - グラフとレポートを生成。

### **3. 非機能要件**
- **エラーハンドリング**：入力エラーやファイル欠落時に適切なエラーメッセージを出力。
- **ロギング**：処理の進行状況をログに出力（INFO、ERRORレベル）。
- **データファイル**：指定されたデータファイルがプロジェクトディレクトリに存在。
- **グラフ**：日本語フォントを使用（`japanize_matplotlib`）、見やすいデザイン（グリッド、凡例、適切なスケール）。
- **フォールバック**：
  - ファイル欠落時: デフォルト値（例: スコア=0）を使用。
  - 出生地不明時: UTCタイムゾーンを使用。
- **セキュリティ**：
  - APIキーは環境変数で管理。
- **テスト**：
  - サンプルデータ（例: Steve Jobs）で単体/統合テストを実施。
- **文化的配慮**：
  - インド文化の伝統を尊重し、正確な用語と解釈を使用。
  - ユーザーにインド占星術/数秘術の理解を深める説明を提供。

### **4. 運勢スコア計算ロジック**

**4.1 プログラムC: ヴェーダ数秘術の運勢スコア計算**
- **目的**: パーソナルイヤーナンバー（PY）にディスティニーナンバー（D）、ソウルナンバー（S）、パーソナリティナンバー（P）を加味して、より高精度な運勢スコアを計算。
- **入力**:
  - `personal_year`（PY）、`destiny_number`（D）、`soul_number`（S）、`personality_number`（P）。
- **出力**:
  - `Dict[str, float]`（カテゴリごとのスコア、-5～+5）。
- **計算ロジック**:
  1. 単純版スコアを取得。
  2. 各ナンバー（D, S, P）とPYの相互作用項を計算：
     - `interaction = +1` if PYスコア > 3 かつ D/S/Pスコア > 3
     - `interaction = -1` if PYスコア < 3 かつ D/S/Pスコア < 3
  3. 係数 Coeff_PY, Coeff_D, Coeff_S, Coeff_Pを用いて統合スコアを計算。
  4. 結果を-5から+5の範囲にクランプ。
  5. 単純版と高精度版のスコアを年ごとに計算、保存（`Dict[str, List[Tuple[int, float]]]`）。

**4.2 プログラムD: インド占星術の運勢スコアを計算する**
- **目的**: ナクシャトラとビムショッタリ・ダシャーに基づく運勢スコアを計算。
- **入力**:
  - `birth_datetime`, `birth_location`, `end_year`, `llm_comment_year`。
- **出力**:
  - `Dict[str, float]`（カテゴリごとのスコア、-5～+5）。
- **計算ロジック**:
  1. **月の黄経計算**:
     - Skyfieldで出生時の月の黄経（`ecliptic_longitude`）を計算。
     - ラヒリ・アヤナムシャを適用：`corrected_longitude = (moon_longitude - ayanamsa) % 360`
  2. **ナクシャトラ特定**:
     - `corrected_longitude`を13.3333度で割ってナクシャトラを特定（`nakshatra_data.json`参照）。
     - パーダ計算: `pada = int((corrected_longitude % 13.3333) / 3.3333) + 1`。
  3. **ダシャ計算**:
     - ナクシャトラの開始順序からビムショッタリ・ダシャーを特定。
     - ダシャー期間を按分して、現在のダシャーと残り期間を計算。
  4. **スコア計算**:
     - ナクシャトラのベーススコア（`nakshatra_data.json`）とパーダ補正を取得（1–6）。
     - ダシャスコア（`nakshatra_data.json`）を取得（1–6）。
     - 統合: `combined_score = (nakshatra_score + dasha_score) / 2`。
     - スケーリング: `final_score = (combined_score - 3.0) * 5.0 / 2.0`。
     - 小数点以下を四捨五入して整数化。
     - `-5`から`+5`の範囲にクランプ。
  5. **トレンド計算**:
     - 誕生年から`end_year`まで年ごとに計算、保存。

**4.3 プログラムE: 総合運勢スコア計算**
- **目的**: C（ヴェーダ数秘術）とD（インド占星術）の運勢スコアを統合。
- **入力**:
  - `numerology_scores`（Cから）、`nakshatra_scores`（Dから）。
- **出力**:
  - `Dict[str, float]`（カテゴリごとの統合スコア、-5～+5）。
- **計算ロジック**:
  1. 各カテゴリ（金運、健康運など）に対して、CとDのスコアを取得。
  2. 相互作用項 `interaction` を計算：
     - `interaction = +1` if Cスコア > 2 かつ Dスコア > 2
     - `interaction = -1` if Cスコア < -2 かつ Dスコア < -2
     - それ以外は `interaction = 0`
  3. 係数 Coeff_D を用いて統合スコアを計算：
     - `combined_score = nakshatra_score + Coeff_D * interaction`
  4. 結果を小数点以下を四捨五入して整数化し、-5から+5の範囲にクランプ。
  5. `llm_comment_year`年の統合スコアを保存。

D先生：“これを読み込んでも、絶対にコードを復元できないと思います。”

QEU:FOUNDER ： “まあね・・・(笑)。”


## ～ まとめ ～

D先生：“十年ぐらい前にTWであったよね。これと似たような現象（↓）が・・・。”

![imageINDS2-44-3](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-3.jpg) 

C部長：“D先生とFOUNDERが悪いんですよ。Vibe Codingなんぞをやるから・・・。**Computer Scienceの魅力が地に落ちた**じゃないですか…。”

![imageINDS2-44-4](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-4.jpg) 

D先生：“すいません・・・。私が**F級戦犯**です。”

C部長：“冗談ですよ。それをF級戦犯って・・・。D先生は、IT関係の失業率と関係あるんですか？”

![imageINDS2-44-5](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-5.jpg) 

QEU:FOUNDER ： “D先生は「甲斐さん（仮名）」です。彼は、そもそもプログラミングが苦手です。そんな彼でも、まともなシステムができることが、**かえって社会にとってインパクトが大きい**んです。率直に言って、プログラムがうまい人がVibe Coding を使ってもメリットがないでしょう。もう、そろそろ世の中が完璧に**「別のフェーズに変わりつつある」**ことを理解しなければならない。”

- **A: 記述統計学（平均、標準偏差など）**
- **B: 基本統計学（回帰分析など：紙と鉛筆でできる）**
- **C: 応用統計学（Random Forestなど：コンピュータが必要）**
- **D: 基本ヒューリスティック（ディープラーニングによる回帰、分類）**
- **E: 応用ヒューリスティック（トランスフォーマー以降）**

QEU:FOUNDER ： “2020年までは、世の中で現実に使われていた管理技術は、統計学がベースとなっています。最近導入された**「ヒューリスティック手法」**は、その当てはめ性能が良いのだが、人々は実務には、あまり採用しませんでした。それが本格的に変わろうとしています。”

C部長：“ヒューリスティック？”

![imageINDS2-44-6](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-6.jpg) 

QEU:FOUNDER ： “ヒューリスティックな手法は、その精度とパフォーマンスは良いが、その当てはめ（学習）のメカニズムがよくわからない場合が多いのです。そのモデルの不明確性、納得性の不足について、いろいろな研究で何とか解明しようとする動きが進んでいます。”

[![MOVIE1](http://img.youtube.com/vi/gQ9zfnMf8lo/0.jpg)](http://www.youtube.com/watch?v=gQ9zfnMf8lo "塚本レポ：ペルソナベクトルとは何か？LLMの人格抽出・可視化・制御の手法")

C部長：“メカニズムがわかってくるとありがたいですね。そうなると、自然と実務への応用も広がってくると思います。そうだ、このソルーション（↓）は、先ほどの分類では、どれに当たるんですか？”

![imageINDS2-44-7](/2025-08-22-QEUR23_INDHS44/imageINDS2-44-7.jpg) 

QEU:FOUNDER ： “Aの**「記述統計学」**ですね。ヒューリスティックの部品として使えるのは2つだけです。”

D先生：“(FOUNDERは、)最近TMについて話をしないですね。そもそも、このプロジェクトのQEUの由来って、「Quality Engineering Unity（TMを統合する）」でしょうに・・・。”

QEU:FOUNDER ： “さすがに時代がここまで高度化してくると、いくらなんでも**肝心の製品設計とプロセス設計が記述統計学に寄り掛かるのは無理がある**でしょう。”

